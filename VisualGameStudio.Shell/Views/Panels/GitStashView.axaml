<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:VisualGameStudio.Shell.ViewModels.Panels"
             mc:Ignorable="d" d:DesignWidth="300" d:DesignHeight="400"
             x:Class="VisualGameStudio.Shell.Views.Panels.GitStashView"
             x:DataType="vm:GitStashViewModel"
             Background="#1E1E1E">

  <DockPanel>
    <!-- Toolbar -->
    <Border DockPanel.Dock="Top" Background="#252526" Padding="4">
      <StackPanel Orientation="Horizontal" Spacing="4">
        <Button Command="{Binding RefreshCommand}"
                ToolTip.Tip="Refresh"
                Background="Transparent"
                Padding="4">
          <TextBlock Text="â†»" FontSize="14"/>
        </Button>
        <Button Command="{Binding DropAllStashesCommand}"
                ToolTip.Tip="Drop All Stashes"
                Background="Transparent"
                Padding="4"
                IsEnabled="{Binding Stashes.Count}">
          <TextBlock Text="ðŸ—‘" FontSize="14"/>
        </Button>
      </StackPanel>
    </Border>

    <!-- Create Stash -->
    <Border DockPanel.Dock="Top" Background="#2D2D2D" Padding="8,4">
      <Grid ColumnDefinitions="*,Auto">
        <TextBox Grid.Column="0"
                 Text="{Binding StashMessage}"
                 Watermark="Stash message (optional)..."
                 FontSize="12"/>
        <Button Grid.Column="1"
                Command="{Binding StashChangesCommand}"
                Content="Stash"
                ToolTip.Tip="Stash Changes"
                Margin="4,0,0,0"/>
      </Grid>
    </Border>

    <!-- Loading -->
    <Border DockPanel.Dock="Top"
            Background="#1E1E1E"
            Padding="8"
            IsVisible="{Binding IsLoading}">
      <TextBlock Text="Loading stashes..."
                 Foreground="#808080"
                 FontSize="11"/>
    </Border>

    <!-- Empty State -->
    <Border DockPanel.Dock="Top"
            Background="#1E1E1E"
            Padding="16"
            IsVisible="{Binding !Stashes.Count}">
      <StackPanel HorizontalAlignment="Center" Spacing="8">
        <TextBlock Text="ðŸ“¦" FontSize="32" HorizontalAlignment="Center"/>
        <TextBlock Text="No stashes"
                   Foreground="#808080"
                   FontSize="12"
                   HorizontalAlignment="Center"/>
        <TextBlock Text="Use 'Stash' button to save your changes"
                   Foreground="#606060"
                   FontSize="11"
                   HorizontalAlignment="Center"/>
      </StackPanel>
    </Border>

    <!-- Stash List -->
    <ListBox ItemsSource="{Binding Stashes}"
             SelectedItem="{Binding SelectedStash}"
             Background="Transparent"
             BorderThickness="0"
             IsVisible="{Binding Stashes.Count}">
      <ListBox.ItemTemplate>
        <DataTemplate>
          <Border Padding="8,6" Background="Transparent">
            <Grid RowDefinitions="Auto,Auto,Auto">
              <!-- Stash Name -->
              <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8">
                <TextBlock Text="{Binding DisplayName}"
                           Foreground="#569CD6"
                           FontWeight="SemiBold"
                           FontSize="12"/>
                <TextBlock Text="{Binding BranchName}"
                           Foreground="#808080"
                           FontSize="11"
                           VerticalAlignment="Center"/>
              </StackPanel>

              <!-- Message -->
              <TextBlock Grid.Row="1"
                         Text="{Binding Summary}"
                         Foreground="#CCCCCC"
                         FontSize="12"
                         TextTrimming="CharacterEllipsis"
                         Margin="0,2,0,0"/>

              <!-- Date -->
              <TextBlock Grid.Row="2"
                         Text="{Binding DateFormatted}"
                         Foreground="#606060"
                         FontSize="10"
                         Margin="0,2,0,0"/>
            </Grid>

            <Border.ContextMenu>
              <ContextMenu>
                <MenuItem Header="Apply"
                          Command="{Binding $parent[ListBox].((vm:GitStashViewModel)DataContext).ApplyStashCommand}"
                          CommandParameter="{Binding}"/>
                <MenuItem Header="Pop"
                          Command="{Binding $parent[ListBox].((vm:GitStashViewModel)DataContext).PopStashCommand}"
                          CommandParameter="{Binding}"/>
                <Separator/>
                <MenuItem Header="Drop"
                          Command="{Binding $parent[ListBox].((vm:GitStashViewModel)DataContext).DropStashCommand}"
                          CommandParameter="{Binding}"/>
              </ContextMenu>
            </Border.ContextMenu>
          </Border>
        </DataTemplate>
      </ListBox.ItemTemplate>
    </ListBox>
  </DockPanel>
</UserControl>
