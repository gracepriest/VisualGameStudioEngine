<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:VisualGameStudio.Shell.ViewModels.Panels"
             mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="300"
             x:Class="VisualGameStudio.Shell.Views.Panels.WatchView"
             x:DataType="vm:WatchViewModel">

  <Border Classes="toolPanel">
    <DockPanel>
      <Border DockPanel.Dock="Top" Classes="panelHeader">
        <Grid ColumnDefinitions="*,Auto">
          <TextBlock Grid.Column="0" Text="Watch" Classes="panelTitle"/>
          <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="2">
            <Button Classes="toolbarButton"
                    ToolTip.Tip="Refresh All"
                    Command="{Binding RefreshAllCommand}"
                    Width="24" Height="24">
              <TextBlock Text="â†»" FontSize="12"/>
            </Button>
            <Button Classes="toolbarButton"
                    ToolTip.Tip="Remove All"
                    Command="{Binding RemoveAllCommand}"
                    Width="24" Height="24">
              <TextBlock Text="ðŸ—‘" FontSize="11"/>
            </Button>
          </StackPanel>
        </Grid>
      </Border>

      <!-- Add expression -->
      <Border DockPanel.Dock="Top" Background="#2D2D2D" Padding="8">
        <Grid ColumnDefinitions="*,Auto">
          <TextBox Grid.Column="0"
                   Text="{Binding NewExpression}"
                   Watermark="Add watch expression..."
                   Margin="0,0,4,0"/>
          <Button Grid.Column="1"
                  Classes="toolbarButton"
                  Command="{Binding AddWatchCommand}"
                  Width="50">
            <TextBlock Text="Add" FontSize="11"/>
          </Button>
        </Grid>
      </Border>

      <!-- Watch list -->
      <DataGrid ItemsSource="{Binding WatchItems}"
                SelectedItem="{Binding SelectedItem}"
                AutoGenerateColumns="False"
                CanUserResizeColumns="True"
                CanUserSortColumns="False"
                HeadersVisibility="Column"
                GridLinesVisibility="Horizontal"
                Background="Transparent">
        <DataGrid.ContextMenu>
          <ContextMenu>
            <MenuItem Header="Copy Value" Command="{Binding CopyValueCommand}"/>
            <MenuItem Header="Copy Expression" Command="{Binding CopyExpressionCommand}"/>
            <Separator/>
            <MenuItem Header="Edit Expression" Command="{Binding EditExpressionCommand}"/>
            <MenuItem Header="Remove" Command="{Binding RemoveWatchCommand}" CommandParameter="{Binding SelectedItem}"/>
            <Separator/>
            <MenuItem Header="Remove All" Command="{Binding RemoveAllCommand}"/>
          </ContextMenu>
        </DataGrid.ContextMenu>
        <DataGrid.Columns>
          <DataGridTemplateColumn Header="Expression" Width="*">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <Grid Margin="4,2">
                  <TextBlock Text="{Binding Expression}"
                             Foreground="#DCDCAA"
                             IsVisible="{Binding !IsEditable}"
                             VerticalAlignment="Center"/>
                  <TextBox Text="{Binding Expression}"
                           IsVisible="{Binding IsEditable}"
                           Watermark="Enter expression..."
                           BorderThickness="0"
                           Background="Transparent"/>
                </Grid>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <DataGridTemplateColumn Header="Value" Width="*">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding Value}"
                           Foreground="{Binding HasError, Converter={x:Static vm:WatchErrorColorConverter.Instance}}"
                           Margin="4,2"
                           VerticalAlignment="Center"
                           TextTrimming="CharacterEllipsis"
                           ToolTip.Tip="{Binding Value}"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <DataGridTemplateColumn Header="Type" Width="100">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding Type}"
                           Foreground="#4EC9B0"
                           Margin="4,2"
                           FontSize="11"
                           VerticalAlignment="Center"/>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <DataGridTemplateColumn Header="" Width="30">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <Button Classes="toolbarButton"
                        Command="{Binding $parent[DataGrid].((vm:WatchViewModel)DataContext).RemoveWatchCommand}"
                        CommandParameter="{Binding}"
                        IsVisible="{Binding !IsEditable}"
                        Width="20" Height="20"
                        ToolTip.Tip="Remove">
                  <TextBlock Text="Ã—" FontSize="12"/>
                </Button>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>
        </DataGrid.Columns>
      </DataGrid>
    </DockPanel>
  </Border>
</UserControl>
