<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:VisualGameStudio.Shell.ViewModels.Dialogs"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="700"
        x:Class="VisualGameStudio.Shell.Views.Dialogs.ConvertToInterfaceDialog"
        x:DataType="vm:ConvertToInterfaceDialogViewModel"
        Title="Convert to Interface"
        Width="600" Height="700"
        WindowStartupLocation="CenterOwner"
        CanResize="False"
        Background="#1E1E1E">

  <DockPanel Margin="16">
    <!-- Header -->
    <StackPanel DockPanel.Dock="Top" Margin="0,0,0,16">
      <TextBlock Text="Convert to Interface" FontSize="16" FontWeight="Bold" Foreground="#CCCCCC"/>
      <TextBlock Foreground="#808080" Margin="0,4,0,0">
        <TextBlock.Text>
          <MultiBinding StringFormat="Extract an interface from class '{0}'">
            <Binding Path="ClassName"/>
          </MultiBinding>
        </TextBlock.Text>
      </TextBlock>
    </StackPanel>

    <!-- Existing Interfaces -->
    <StackPanel DockPanel.Dock="Top" Margin="0,0,0,12"
                IsVisible="{Binding ExistingInterfaces.Count}">
      <TextBlock Text="Existing interfaces:" Foreground="#808080" FontSize="11" Margin="0,0,0,4"/>
      <ItemsControl ItemsSource="{Binding ExistingInterfaces}">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <WrapPanel Orientation="Horizontal"/>
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <Border Background="#3C3C3C" CornerRadius="3" Padding="6,2" Margin="0,0,4,4">
              <TextBlock Text="{Binding}" Foreground="#4EC9B0" FontFamily="Consolas"/>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </StackPanel>

    <!-- Interface Settings -->
    <Grid DockPanel.Dock="Top" RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="Auto,*" Margin="0,0,0,16">
      <!-- Interface Name -->
      <TextBlock Grid.Row="0" Grid.Column="0"
                 Text="Interface name:"
                 Foreground="#CCCCCC"
                 VerticalAlignment="Center"
                 Margin="0,0,12,8"/>
      <TextBox Grid.Row="0" Grid.Column="1"
               Text="{Binding InterfaceName}"
               Watermark="Enter interface name..."
               x:Name="InterfaceNameTextBox"
               Margin="0,0,0,8"/>

      <!-- File Location -->
      <TextBlock Grid.Row="1" Grid.Column="0"
                 Text="Location:"
                 Foreground="#CCCCCC"
                 VerticalAlignment="Top"
                 Margin="0,4,12,8"/>
      <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,0,0,8">
        <RadioButton IsChecked="{Binding CreateInSameFile}"
                     Content="Add to same file"
                     Foreground="#CCCCCC"
                     GroupName="Location"
                     Margin="0,0,0,4"/>
        <StackPanel Orientation="Horizontal" Margin="20,0,0,4">
          <CheckBox IsChecked="{Binding AddAboveClass}"
                    Content="Place above class definition"
                    Foreground="#CCCCCC"
                    IsEnabled="{Binding CreateInSameFile}"/>
        </StackPanel>
        <RadioButton IsChecked="{Binding CreateInNewFile}"
                     Content="Create in new file"
                     Foreground="#CCCCCC"
                     GroupName="Location"
                     Margin="0,4,0,4"/>
        <TextBox Text="{Binding FileName}"
                 Watermark="Enter file name..."
                 IsEnabled="{Binding CreateInNewFile}"
                 Margin="20,0,0,4"/>
      </StackPanel>

      <!-- Implement Interface -->
      <CheckBox Grid.Row="2" Grid.Column="1"
                IsChecked="{Binding ImplementInterface}"
                Content="Add Implements clause to class"
                Foreground="#CCCCCC"
                Margin="0,0,0,8"/>
    </Grid>

    <!-- Members Selection -->
    <TextBlock DockPanel.Dock="Top"
               Foreground="#808080"
               FontSize="11"
               Margin="0,0,0,4">
      <TextBlock.Text>
        <MultiBinding StringFormat="Select public members to include ({0} selected):">
          <Binding Path="SelectedMemberCount"/>
        </MultiBinding>
      </TextBlock.Text>
    </TextBlock>

    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Spacing="8" Margin="0,0,0,4">
      <Button Content="Select All" Command="{Binding SelectAllCommand}" Padding="8,2"/>
      <Button Content="Select None" Command="{Binding SelectNoneCommand}" Padding="8,2"/>
    </StackPanel>

    <Border DockPanel.Dock="Top"
            Background="#252526"
            BorderBrush="#3C3C3C"
            BorderThickness="1"
            CornerRadius="4"
            Margin="0,0,0,16"
            Height="150">
      <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
        <ItemsControl ItemsSource="{Binding Members}" Margin="4">
          <ItemsControl.ItemTemplate>
            <DataTemplate DataType="vm:ConvertToInterfaceMemberViewModel">
              <CheckBox IsChecked="{Binding IsSelected}"
                        Margin="4,2">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <TextBlock Text="{Binding Kind}"
                             Foreground="#569CD6"
                             FontFamily="Consolas"
                             Width="70"/>
                  <TextBlock Text="{Binding InterfaceSignature}"
                             Foreground="#DCDCAA"
                             FontFamily="Consolas"/>
                </StackPanel>
              </CheckBox>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>
    </Border>

    <!-- Error Message -->
    <TextBlock DockPanel.Dock="Top"
               Text="{Binding ErrorMessage}"
               Foreground="#F48771"
               FontSize="11"
               Margin="0,0,0,8"
               TextWrapping="Wrap"
               IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

    <!-- Preview -->
    <TextBlock DockPanel.Dock="Top"
               Text="Preview:"
               Foreground="#808080"
               FontSize="11"
               Margin="0,0,0,4"/>
    <Border DockPanel.Dock="Top"
            Background="#252526"
            BorderBrush="#3C3C3C"
            BorderThickness="1"
            CornerRadius="4"
            Margin="0,0,0,16"
            MaxHeight="150">
      <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
        <TextBlock Text="{Binding Preview}"
                   FontFamily="Consolas, Courier New, monospace"
                   FontSize="12"
                   Foreground="#DCDCAA"
                   Padding="8"
                   TextWrapping="NoWrap"/>
      </ScrollViewer>
    </Border>

    <!-- Loading Indicator -->
    <StackPanel DockPanel.Dock="Top"
                Orientation="Horizontal"
                HorizontalAlignment="Center"
                IsVisible="{Binding IsLoading}"
                Margin="0,0,0,16">
      <TextBlock Text="Processing..." Foreground="#808080"/>
    </StackPanel>

    <!-- Buttons -->
    <StackPanel DockPanel.Dock="Bottom"
                Orientation="Horizontal"
                HorizontalAlignment="Right"
                Spacing="8">
      <Button Content="Cancel"
              Command="{Binding CancelCommand}"
              Width="80"/>
      <Button Content="Convert"
              Command="{Binding ConvertCommand}"
              Width="100"
              Classes="accent"
              IsEnabled="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNullOrEmpty}}"/>
    </StackPanel>
  </DockPanel>
</Window>
