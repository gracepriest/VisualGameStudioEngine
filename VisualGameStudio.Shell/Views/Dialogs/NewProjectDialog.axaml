<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:VisualGameStudio.Shell.ViewModels.Dialogs"
        mc:Ignorable="d" d:DesignWidth="700" d:DesignHeight="500"
        x:Class="VisualGameStudio.Shell.Views.Dialogs.NewProjectDialog"
        x:DataType="vm:NewProjectViewModel"
        Title="New Project"
        Width="700" Height="500"
        WindowStartupLocation="CenterOwner"
        CanResize="False">

  <Grid RowDefinitions="*,Auto" Background="#1E1E1E">
    <!-- Main Content -->
    <Grid Grid.Row="0" ColumnDefinitions="250,*" Margin="16">
      <!-- Template List -->
      <Border Grid.Column="0" Background="#252526" CornerRadius="4" Margin="0,0,8,0">
        <DockPanel>
          <TextBlock DockPanel.Dock="Top"
                     Text="Project Templates"
                     FontWeight="SemiBold"
                     Margin="12,12,12,8"/>

          <ListBox ItemsSource="{Binding Templates}"
                   SelectedItem="{Binding SelectedTemplate}"
                   Background="Transparent"
                   Padding="4">
            <ListBox.ItemTemplate>
              <DataTemplate>
                <Grid ColumnDefinitions="Auto,*" Margin="4">
                  <TextBlock Grid.Column="0"
                             Text="{Binding Icon}"
                             FontSize="24"
                             VerticalAlignment="Center"
                             Margin="0,0,12,0"/>
                  <StackPanel Grid.Column="1">
                    <TextBlock Text="{Binding Name}"
                               FontWeight="SemiBold"
                               FontSize="13"/>
                    <TextBlock Text="{Binding Description}"
                               Foreground="#808080"
                               FontSize="11"
                               TextWrapping="Wrap"/>
                  </StackPanel>
                </Grid>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>
        </DockPanel>
      </Border>

      <!-- Project Settings -->
      <StackPanel Grid.Column="1" Spacing="16">
        <Border Background="#252526" CornerRadius="4" Padding="16">
          <StackPanel Spacing="12">
            <TextBlock Text="Configure your new project"
                       FontWeight="SemiBold"
                       FontSize="16"/>

            <StackPanel Spacing="4">
              <TextBlock Text="Project name"/>
              <TextBox Text="{Binding ProjectName}"
                       Watermark="Enter project name"/>
            </StackPanel>

            <StackPanel Spacing="4">
              <TextBlock Text="Location"/>
              <Grid ColumnDefinitions="*,Auto">
                <TextBox Grid.Column="0"
                         Text="{Binding Location}"
                         Watermark="Select location"
                         Margin="0,0,4,0"/>
                <Button Grid.Column="1"
                        Content="Browse..."
                        x:Name="BrowseButton"
                        Width="80"/>
              </Grid>
            </StackPanel>

            <CheckBox Content="Create directory for project"
                      IsChecked="{Binding CreateDirectory}"/>

            <StackPanel Spacing="4" IsVisible="{Binding CreateDirectory}">
              <TextBlock Text="Project will be created in:"
                         Foreground="#808080"
                         FontSize="11"/>
              <TextBlock FontSize="11"
                         Foreground="#569CD6"
                         TextWrapping="Wrap">
                <TextBlock.Text>
                  <MultiBinding StringFormat="{}{0}\{1}">
                    <Binding Path="Location"/>
                    <Binding Path="ProjectName"/>
                  </MultiBinding>
                </TextBlock.Text>
              </TextBlock>
            </StackPanel>
          </StackPanel>
        </Border>

        <!-- Template Preview -->
        <Border Background="#252526" CornerRadius="4" Padding="16"
                IsVisible="{Binding SelectedTemplate, Converter={x:Static ObjectConverters.IsNotNull}}">
          <StackPanel Spacing="8">
            <TextBlock Text="Template Preview"
                       FontWeight="SemiBold"/>
            <Border Background="#1E1E1E" CornerRadius="4" Padding="8" MaxHeight="150">
              <ScrollViewer>
                <TextBlock Text="{Binding SelectedTemplate.DefaultCode}"
                           FontFamily="Cascadia Code, Consolas, monospace"
                           FontSize="11"
                           Foreground="#D4D4D4"/>
              </ScrollViewer>
            </Border>
          </StackPanel>
        </Border>

        <!-- Error Message -->
        <Border Background="#4E2A2A"
                CornerRadius="4"
                Padding="12"
                IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
          <TextBlock Text="{Binding ErrorMessage}"
                     Foreground="#F48771"/>
        </Border>
      </StackPanel>
    </Grid>

    <!-- Buttons -->
    <Border Grid.Row="1"
            Background="#2D2D2D"
            Padding="16,12"
            BorderThickness="0,1,0,0"
            BorderBrush="#3C3C3C">
      <StackPanel Orientation="Horizontal"
                  HorizontalAlignment="Right"
                  Spacing="8">
        <Button Content="Create"
                Command="{Binding CreateProjectCommand}"
                Width="100"
                Classes="accent"/>
        <Button Content="Cancel"
                Command="{Binding CancelCommand}"
                Width="100"/>
      </StackPanel>
    </Border>
  </Grid>
</Window>
