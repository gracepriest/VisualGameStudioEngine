<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:VisualGameStudio.Shell.ViewModels.Dialogs"
        xmlns:services="using:VisualGameStudio.Core.Abstractions.Services"
        mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="650"
        x:Class="VisualGameStudio.Shell.Views.Dialogs.CreateProjectView"
        x:DataType="vm:CreateProjectViewModel"
        Title="Create a new project"
        Width="900" Height="650"
        WindowStartupLocation="CenterOwner"
        CanResize="False"
        ShowInTaskbar="False">

    <Design.DataContext>
        <vm:CreateProjectDesignViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header -->
        <Border Grid.Row="0" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}" Padding="20">
            <StackPanel>
                <TextBlock Text="Create a new project" FontSize="24" FontWeight="SemiBold" Margin="0,0,0,8"/>
                <TextBlock Text="Choose a solution type and project template to get started"
                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
            </StackPanel>
        </Border>

        <!-- Content -->
        <Grid Grid.Row="1" ColumnDefinitions="280,*" Margin="0">

            <!-- Left Panel - Solution Types and Templates -->
            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                    BorderThickness="0,0,1,0">
                <Grid RowDefinitions="Auto,*">

                    <!-- Solution Type Selection -->
                    <StackPanel Grid.Row="0" Margin="16">
                        <TextBlock Text="Solution Type" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <ComboBox ItemsSource="{Binding SolutionTypes}"
                                  SelectedItem="{Binding SelectedSolutionType}"
                                  HorizontalAlignment="Stretch">
                            <ComboBox.ItemTemplate>
                                <DataTemplate x:DataType="services:SolutionType">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <PathIcon Data="{DynamicResource CodeIcon}" Width="16" Height="16"/>
                                        <TextBlock Text="{Binding Name}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        <TextBlock Text="{Binding SelectedSolutionType.Description}"
                                   TextWrapping="Wrap"
                                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                   FontSize="12"
                                   Margin="0,8,0,0"/>
                    </StackPanel>

                    <!-- Project Templates List -->
                    <Grid Grid.Row="1" RowDefinitions="Auto,*">
                        <StackPanel Grid.Row="0" Margin="16,0,16,8">
                            <TextBlock Text="Project Template" FontWeight="SemiBold" Margin="0,0,0,8"/>
                            <TextBox Watermark="Search templates..."
                                     Text="{Binding SearchText}"/>
                        </StackPanel>

                        <ListBox Grid.Row="1"
                                 ItemsSource="{Binding ProjectTemplates}"
                                 SelectedItem="{Binding SelectedTemplate}"
                                 Margin="8,0,8,8">
                            <ListBox.ItemTemplate>
                                <DataTemplate x:DataType="services:ProjectTemplate">
                                    <Border Padding="8" Cursor="Hand">
                                        <Grid ColumnDefinitions="40,*">
                                            <Border Grid.Column="0"
                                                    Width="32" Height="32"
                                                    CornerRadius="4"
                                                    Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}">
                                                <PathIcon Data="{DynamicResource DocumentIcon}"
                                                          Width="16" Height="16"/>
                                            </Border>
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                                <TextBlock Text="{Binding ShortDescription}"
                                                           FontSize="12"
                                                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                                           TextTrimming="CharacterEllipsis"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Grid>
            </Border>

            <!-- Right Panel - Project Configuration -->
            <ScrollViewer Grid.Column="1" Padding="20">
                <StackPanel Spacing="16">

                    <!-- Template Info -->
                    <Border Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                            CornerRadius="4"
                            Padding="16"
                            IsVisible="{Binding SelectedTemplate, Converter={x:Static ObjectConverters.IsNotNull}}">
                        <StackPanel>
                            <TextBlock Text="{Binding SelectedTemplate.Name}"
                                       FontSize="18" FontWeight="SemiBold"/>
                            <TextBlock Text="{Binding SelectedTemplate.Description}"
                                       TextWrapping="Wrap"
                                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                       Margin="0,8,0,0"/>
                            <WrapPanel Margin="0,12,0,0">
                                <ItemsControl ItemsSource="{Binding SelectedTemplate.Tags}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                                                    CornerRadius="2"
                                                    Padding="6,2"
                                                    Margin="0,0,4,4">
                                                <TextBlock Text="{Binding}" FontSize="11"/>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </WrapPanel>
                        </StackPanel>
                    </Border>

                    <!-- Project Name -->
                    <StackPanel>
                        <TextBlock Text="Project name" FontWeight="SemiBold" Margin="0,0,0,4"/>
                        <TextBox Text="{Binding ProjectName}"
                                 Watermark="Enter project name"/>
                    </StackPanel>

                    <!-- Location -->
                    <StackPanel>
                        <TextBlock Text="Location" FontWeight="SemiBold" Margin="0,0,0,4"/>
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBox Grid.Column="0"
                                     Text="{Binding Location}"
                                     Watermark="Select project location"/>
                            <Button Grid.Column="1"
                                    Content="Browse..."
                                    Command="{Binding BrowseLocationCommand}"
                                    Margin="8,0,0,0"/>
                        </Grid>
                    </StackPanel>

                    <!-- Target Framework (only for .NET/MSIL) -->
                    <StackPanel IsVisible="{Binding ShowFrameworkSelector}">
                        <TextBlock Text="Target framework" FontWeight="SemiBold" Margin="0,0,0,4"/>
                        <ComboBox ItemsSource="{Binding TargetFrameworks}"
                                  SelectedItem="{Binding TargetFramework}"
                                  HorizontalAlignment="Stretch"/>
                    </StackPanel>

                    <!-- Options -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Options" FontWeight="SemiBold"/>
                        <CheckBox Content="Create solution folder"
                                  IsChecked="{Binding CreateSolutionFolder}"/>
                        <CheckBox Content="Initialize Git repository"
                                  IsChecked="{Binding CreateGitRepository}"/>
                    </StackPanel>

                    <!-- Advanced -->
                    <Expander Header="Advanced options">
                        <StackPanel Margin="0,8,0,0" Spacing="12">
                            <StackPanel>
                                <TextBlock Text="Custom namespace (optional)" Margin="0,0,0,4"/>
                                <TextBox Text="{Binding CustomNamespace}"
                                         Watermark="Leave empty to use project name"/>
                            </StackPanel>
                        </StackPanel>
                    </Expander>

                    <!-- Error Message -->
                    <Border Background="#44FF0000"
                            CornerRadius="4"
                            Padding="12"
                            IsVisible="{Binding HasError}">
                        <TextBlock Text="{Binding ErrorMessage}"
                                   Foreground="White"
                                   TextWrapping="Wrap"/>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- Footer -->
        <Border Grid.Row="2"
                Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                Padding="20,12">
            <Grid ColumnDefinitions="*,Auto,Auto">
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Creating project..."
                               IsVisible="{Binding IsCreating}"
                               FontStyle="Italic"
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                </StackPanel>
                <Button Grid.Column="1"
                        Content="Cancel"
                        Command="{Binding CancelCommand}"
                        Margin="0,0,8,0"
                        MinWidth="80"/>
                <Button Grid.Column="2"
                        Content="Create"
                        Command="{Binding CreateProjectCommand}"
                        IsEnabled="{Binding CanCreate}"
                        Classes="accent"
                        MinWidth="80"/>
            </Grid>
        </Border>
    </Grid>
</Window>
