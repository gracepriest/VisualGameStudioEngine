<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:VisualGameStudio.Shell.ViewModels.Dialogs"
        mc:Ignorable="d" d:DesignWidth="650" d:DesignHeight="550"
        x:Class="VisualGameStudio.Shell.Views.Dialogs.ChangeSignatureDialog"
        x:DataType="vm:ChangeSignatureDialogViewModel"
        Title="Change Signature"
        Width="650" Height="550"
        WindowStartupLocation="CenterOwner"
        CanResize="False"
        Background="#1E1E1E">

  <DockPanel Margin="16">
    <!-- Header -->
    <StackPanel DockPanel.Dock="Top" Margin="0,0,0,16">
      <TextBlock Text="Change Signature" FontSize="16" FontWeight="Bold" Foreground="#CCCCCC"/>
      <TextBlock Foreground="#808080" Margin="0,4,0,0">
        <TextBlock.Text>
          <MultiBinding StringFormat="Modify parameters for {0} ({1} call sites)">
            <Binding Path="MethodName"/>
            <Binding Path="CallSiteCount"/>
          </MultiBinding>
        </TextBlock.Text>
      </TextBlock>
    </StackPanel>

    <!-- Parameters Section -->
    <TextBlock DockPanel.Dock="Top"
               Text="Parameters:"
               Foreground="#808080"
               FontSize="11"
               Margin="0,0,0,4"/>

    <!-- Parameters List with Buttons -->
    <Grid DockPanel.Dock="Top" ColumnDefinitions="*,Auto" Margin="0,0,0,16" Height="200">
      <!-- Parameters DataGrid -->
      <Border Grid.Column="0"
              Background="#252526"
              BorderBrush="#3C3C3C"
              BorderThickness="1"
              CornerRadius="4">
        <DataGrid ItemsSource="{Binding Parameters}"
                  SelectedItem="{Binding SelectedParameter}"
                  AutoGenerateColumns="False"
                  CanUserReorderColumns="False"
                  CanUserResizeColumns="True"
                  CanUserSortColumns="False"
                  HeadersVisibility="Column"
                  GridLinesVisibility="Horizontal"
                  Background="Transparent"
                  RowBackground="#252526">
          <DataGrid.Columns>
            <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="120"/>
            <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="100"/>
            <DataGridCheckBoxColumn Header="ByRef" Binding="{Binding IsByRef}" Width="60"/>
            <DataGridCheckBoxColumn Header="Optional" Binding="{Binding IsOptional}" Width="70"/>
            <DataGridTextColumn Header="Default Value" Binding="{Binding DefaultValue}" Width="*"/>
          </DataGrid.Columns>
        </DataGrid>
      </Border>

      <!-- Parameter Action Buttons -->
      <StackPanel Grid.Column="1" Spacing="4" Margin="8,0,0,0">
        <Button Content="Add" Command="{Binding AddParameterCommand}" Width="70"/>
        <Button Content="Remove" Command="{Binding RemoveParameterCommand}" Width="70"
                IsEnabled="{Binding SelectedParameter, Converter={x:Static ObjectConverters.IsNotNull}}"/>
        <Separator Height="8" Background="Transparent"/>
        <Button Content="Move Up" Command="{Binding MoveUpCommand}" Width="70"
                IsEnabled="{Binding SelectedParameter, Converter={x:Static ObjectConverters.IsNotNull}}"/>
        <Button Content="Move Down" Command="{Binding MoveDownCommand}" Width="70"
                IsEnabled="{Binding SelectedParameter, Converter={x:Static ObjectConverters.IsNotNull}}"/>
      </StackPanel>
    </Grid>

    <!-- Return Type (for functions) -->
    <Grid DockPanel.Dock="Top" RowDefinitions="Auto" ColumnDefinitions="Auto,*" Margin="0,0,0,16"
          IsVisible="{Binding IsFunction}">
      <TextBlock Grid.Row="0" Grid.Column="0"
                 Text="Return type:"
                 Foreground="#CCCCCC"
                 VerticalAlignment="Center"
                 Margin="0,0,12,0"/>
      <ComboBox Grid.Row="0" Grid.Column="1"
                ItemsSource="{Binding CommonTypes}"
                SelectedItem="{Binding NewReturnType}"
                MinWidth="150"/>
    </Grid>

    <!-- Error Message -->
    <TextBlock DockPanel.Dock="Top"
               Text="{Binding ErrorMessage}"
               Foreground="#F48771"
               FontSize="11"
               Margin="0,0,0,8"
               TextWrapping="Wrap"
               IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

    <!-- Preview -->
    <TextBlock DockPanel.Dock="Top"
               Text="Signature preview:"
               Foreground="#808080"
               FontSize="11"
               Margin="0,0,0,4"/>
    <Border DockPanel.Dock="Top"
            Background="#252526"
            BorderBrush="#3C3C3C"
            BorderThickness="1"
            CornerRadius="4"
            Margin="0,0,0,16">
      <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
        <TextBlock Text="{Binding PreviewSignature}"
                   FontFamily="Consolas, Courier New, monospace"
                   FontSize="12"
                   Foreground="#DCDCAA"
                   Padding="8"
                   TextWrapping="NoWrap"/>
      </ScrollViewer>
    </Border>

    <!-- Loading Indicator -->
    <StackPanel DockPanel.Dock="Top"
                Orientation="Horizontal"
                HorizontalAlignment="Center"
                IsVisible="{Binding IsLoading}"
                Margin="0,0,0,16">
      <TextBlock Text="Applying changes..." Foreground="#808080"/>
    </StackPanel>

    <!-- Buttons -->
    <StackPanel DockPanel.Dock="Bottom"
                Orientation="Horizontal"
                HorizontalAlignment="Right"
                Spacing="8">
      <Button Content="Cancel"
              Command="{Binding CancelCommand}"
              Width="80"/>
      <Button Content="Apply"
              Command="{Binding ApplyCommand}"
              Width="80"
              Classes="accent"
              IsEnabled="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNullOrEmpty}}"/>
    </StackPanel>
  </DockPanel>
</Window>
